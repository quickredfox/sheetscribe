(function(window,undefined){var FMATCH="$1",LCURL="{",RCURL="}",DRCURL="}}",EMPTY="",COLON=":",SEMI=";",SPC=" ",COMMA=",",TAB="\t",NL="\n";var log=function(){if(window.console){return window.console.log.apply(null,arguments)}var __noop=function(){};window.console={info:__noop,log:__noop,debug:__noop};return arguments};if(!Array.prototype.forEach){Array.prototype.forEach=function(fun){var len=this.length>>>0;if(typeof fun!="function"){throw new TypeError()}var thisp=arguments[1];for(var i=0;i<len;i++){if(i in this){fun.call(thisp,this[i],i,this)}}}}RegExp.customEscape=function(text){if(!arguments.callee.sRE){var specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\","@","^","%","#","&","$"];arguments.callee.sRE=new RegExp("(\\"+specials.join("|\\")+")","g")}return text.replace(arguments.callee.sRE,"\\$1")};String.prototype.bisect=function(delimiter){var re=new RegExp();var esc=RegExp.customEscape(delimiter);re.compile(esc+"(.+)");return this.split(re,2)};String.prototype.numOccurences=function(chr){return --(this.split(chr).length)};var Declaration=function(selector,properties){this.selector=selector;this.properties=properties;this.toString=function(){return this.selector}};var Property=function(name,groups){this.name=name;this.groups=groups;this.toString=function(){return this.name}};function integral(css){return css.numOccurences(LCURL)===css.numOccurences(RCURL)&&!(integral.RE[0]).test(css)&&!(integral.RE[1]).test(css)}integral.RE=[(/[\{\;]\s+?\-/g),(/filter\:/)];function clean(css){clean.RE.forEach(function(re){css=css.replace(re[0],re[1])});return snip(css)}clean.RE=[[(/\/\*[^*]*\*+([^\/*][^*]*\*+)*\//g),EMPTY],[(/([\r\n\t\s]){1,}/gm),FMATCH],[(/[\n\t\s\r]*([\{\;\:\}])[\n\t\s\r]*/g),FMATCH],[(/([^\}\;])\}/g),FMATCH+";}"]];function snip(str){return str.replace(/^[\s]+|[\s]+$/g,EMPTY)}function travel(chr,str,fn){var parts=str.bisect(chr);fn(parts[0],parts[1]);if((/\{/).test(parts[1])){return travel(chr,parts[1],fn)}}function munge(css,extracted,results){var extracted=extracted||munge.extractMedias(css);results=results||{};extracted.forEach(function(blk,index){var selectors={};munge.stripCurlies(blk).match(/([^\}]+)\{([^\}])+\}/g).forEach(function(m){munge.addSelector(m.trim(),selectors)});blk.match(/\@media([^\{]+)/)[1].split(",").forEach(function(n,i,a){var name=n.trim();if(!results[name]){results[name]=[]}results[name].push(selectors)})});return results}munge.stripCurlies=function(str){return str.substring(str.indexOf(LCURL)+1,str.lastIndexOf(RCURL))};munge.addSelector=function(str,obj){return obj[str.substring(0,str.indexOf(LCURL))]=str.substring(str.indexOf(LCURL)+1,str.length-1)};munge.extractMedias=function(css){var all=css=clean(css),medias=[],mat,ind,strt,end,blk;all=css.replace(/(\@media.+?\}\})/g,function(m){medias.push(m);return""});medias.push("@media all{"+all+"}");return medias};function parseProperties(properties){var props=[],name,colon;properties.split(SEMI).forEach(function(pair){colon=pair.indexOf(COLON);if(name=pair.substring(0,colon)){props.push(new Property(name,pair.substring(colon+1).split(COMMA)))}});return props}var dev2=false;function tokenize(css,context,tokens){var munged=(typeof css=="string"?munge(css):css);for(var media in munged){var sheet={};munged[media].forEach(function(m,i,a){var decl={};for(var selector in m){decl[selector]=new Declaration(selector,parseProperties(m[selector]))}munged[media]=decl})}return munged}tokenize.RE=[(/\@media\s+?(\w+)?/)];function stringify(tokenized){var css=[],vals;for(var media in tokenized){css.push("@media "+media+LCURL);for(var k in tokenized[media]){dec=tokenized[media][k];css.push(TAB+dec.selector+LCURL);dec.properties.forEach(function(prop){var vals=prop.groups.join(COMMA);css.push([TAB,SPC,prop.name,COLON,vals,SEMI].join(EMPTY))});css.push(TAB+RCURL)}css.push(RCURL)}return css.join(NL)}function parse(css,media,processors){var opts=parse.shuffleArgs(arguments)}parse.assign=function(arguments){var tokens=arguments[0],media=arguments[1],processors=arguments[2];if(typeof tokens=="string"){tokens=tokenize(tokens)}};if(!window.SheetScribe){window.SheetScribe={tokenize:tokenize,stringify:stringify}}})(this);